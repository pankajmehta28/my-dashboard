<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blank Markets Update</title>
</head>
<body>
    <h1>Update Blank Markets</h1>

    <div>
        <button id="fetchButton">Fetch Blank Markets</button>
    </div>

    <div id="marketsContainer"></div>

    <div>
        <button id="updateButton">Update Markets</button>
    </div>

    <script>
        // Backend API Base URL (safe: use relative path, not localhost or IP)
        const backendBaseUrl = '/api'; // Assuming you deploy both frontend + backend together
        const backendFetchUrl = `${backendBaseUrl}/get-blank-markets`;
        const backendUpdateUrl = `${backendBaseUrl}/update-markets`;

        let marketData = [];

        document.getElementById('fetchButton').addEventListener('click', async () => {
            try {
                const response = await fetch(backendFetchUrl);
                if (!response.ok) throw new Error('Failed to fetch markets');
                
                marketData = await response.json();
                renderMarkets(marketData);
            } catch (error) {
                console.error('Error fetching markets:', error);
            }
        });

        document.getElementById('updateButton').addEventListener('click', async () => {
            try {
                const updatedData = marketData.map((market, index) => {
                    const input = document.getElementById(`market-${index}`);
                    return { ...market, newMarket: input.value };
                });

                const response = await fetch(backendUpdateUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData),
                });

                if (!response.ok) throw new Error('Failed to update markets');

                alert('Markets updated successfully!');
            } catch (error) {
                console.error('Error updating markets:', error);
            }
        });

        function renderMarkets(markets) {
            const container = document.getElementById('marketsContainer');
            container.innerHTML = '';

            markets.forEach((market, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label>${market.existingMarket}</label>
                    <input id="market-${index}" type="text" value="${market.newMarket || ''}" />
                `;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
